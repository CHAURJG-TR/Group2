<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>æ•™å®¤åˆ†çµ„åº§ä½ç³»çµ±</title>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

<style>
:root{
  --bg:#eef2f7;
  --card:#ffffff;
  --seat:#e9edf3;
  --seat-hover:#dfe6f1;
  --stage:#2f3640;
  --accent:#4b7bec;
}

body{
  font-family:"Noto Sans TC","Microsoft JhengHei",sans-serif;
  background:linear-gradient(180deg,#eef2f7,#dde3ec);
  margin:0;
  padding:20px;
  color:#222;
}

h1{margin:0 0 10px}
h3{margin:14px 0 6px}

input,textarea{
  width:100%;
  font-size:17px;
  padding:8px;
  border-radius:8px;
  border:1px solid #cfd6e0;
  box-sizing:border-box;
}

textarea{min-height:80px}

button{
  font-size:18px;
  padding:10px 14px;
  margin:6px 6px 6px 0;
  border-radius:10px;
  border:none;
  background:var(--accent);
  color:#fff;
  cursor:pointer;
  box-shadow:0 4px 10px rgba(0,0,0,.15);
}
button:hover{opacity:.9}

.stage{
  background:linear-gradient(180deg,#444,#222);
  color:#fff;
  font-size:30px;
  text-align:center;
  padding:16px;
  margin:20px 0;
  border-radius:14px;
  box-shadow:0 6px 16px rgba(0,0,0,.3);
  letter-spacing:4px;
}

.groups{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:22px;
}

.group{
  background:var(--card);
  border-radius:18px;
  padding:14px;
  box-shadow:0 10px 22px rgba(0,0,0,.12);
}

.group h3{
  text-align:center;
  margin:6px 0 10px;
  font-size:22px;
}

.row{
  display:flex;
  justify-content:space-between;
}

.seat{
  flex:1;
  margin:6px;
  background:var(--seat);
  border-radius:10px;
  padding:12px 6px;
  text-align:center;
  font-size:22px;
  cursor:grab;
  box-shadow:inset 0 0 0 1px #cfd6e0,
             0 3px 6px rgba(0,0,0,.15);
  transition:.15s;
}

.seat:hover{
  background:var(--seat-hover);
}

.seat:active{
  cursor:grabbing;
  transform:scale(.97);
}

.back{
  margin-top:6px;
  display:flex;
  justify-content:center;
}

hr{
  border:none;
  border-top:2px dashed #d0d7e2;
  margin:8px 0;
}

/* æŠ•å½±æ¨¡å¼ */
.fullscreen{
  background:#000;
  color:#fff;
}
.fullscreen .group{
  background:#111;
}
.fullscreen .seat{
  font-size:34px;
  background:#222;
  color:#fff;
}
.fullscreen .group h3{
  font-size:30px;
}
</style>
</head>

<body>

<h1>ğŸ“š æ•™å®¤åˆ†çµ„åº§ä½ç³»çµ±</h1>

<h3>ğŸ”¢ åˆ†çµ„è¨­å®š</h3>
<input id="groupCount" type="number" value="4" placeholder="ç¸½çµ„æ•¸ï¼ˆå¶æ•¸ï¼‰">
<input id="groupSize" type="number" value="5" placeholder="æ¯çµ„äººæ•¸">

<h3>ğŸ‘¦ ç”·ç”Ÿå§“åï¼ˆæ¯è¡Œä¸€äººï¼‰</h3>
<textarea id="maleList"></textarea>

<h3>ğŸ‘§ å¥³ç”Ÿå§“åï¼ˆæ¯è¡Œä¸€äººï¼‰</h3>
<textarea id="femaleList"></textarea>

<h3>ğŸš« ä¸èƒ½åŒçµ„ï¼ˆæ¯è¡Œ A,Bï¼‰</h3>
<textarea id="banRules"></textarea>

<button onclick="generate()">ğŸ¯ ç”Ÿæˆåº§ä½</button>
<button onclick="toggleFullscreen()">ğŸ–¥ï¸ æŠ•å½±æ¨¡å¼</button>
<button onclick="exportPDF()">ğŸ–¨ï¸ åŒ¯å‡º PDF</button>

<div id="canvasArea"></div>

<script>
const shuffle=a=>[...a].sort(()=>Math.random()-0.5);

function generate(){
  const gCount=+groupCount.value;
  const gSize=+groupSize.value;

  if(gCount<2||gCount%2!==0){alert("âŒ çµ„æ•¸å¿…é ˆæ˜¯å¶æ•¸");return;}

  const males=maleList.value.split("\n").map(s=>s.trim()).filter(Boolean);
  const females=femaleList.value.split("\n").map(s=>s.trim()).filter(Boolean);

  if(new Set([...males,...females]).size!==males.length+females.length){
    alert("âŒ æœ‰é‡è¤‡å§“å");return;
  }

  const mg=gCount/2,fg=gCount/2;
  if(males.length!==mg*gSize||females.length!==fg*gSize){
    alert("âŒ äººæ•¸ç„¡æ³•å¹³å‡åˆ†çµ„");return;
  }

  const rules=banRules.value.split("\n").map(r=>r.split(",").map(s=>s.trim())).filter(r=>r.length===2);

  const groups=[],sm=shuffle(males),sf=shuffle(females);
  for(let i=0;i<mg;i++)groups.push(sm.slice(i*gSize,(i+1)*gSize));
  for(let i=0;i<fg;i++)groups.push(sf.slice(i*gSize,(i+1)*gSize));

  for(const r of rules){
    for(const g of groups){
      if(r.every(n=>g.includes(n))){
        alert(`âŒ è¦å‰‡è¡çªï¼š${r.join("ã€")}`);return;
      }
    }
  }
  render(groups);
}

function render(groups){
  canvasArea.innerHTML="";
  canvasArea.appendChild(Object.assign(document.createElement("div"),{
    className:"stage",textContent:"ğŸ“¢ è¬›å°"
  }));

  const box=document.createElement("div");
  box.className="groups";

  groups.forEach((g,i)=>{
    const d=document.createElement("div");
    d.className="group";
    d.innerHTML=`<h3>ç¬¬ ${i+1} çµ„</h3>`;

    const r1=document.createElement("div");r1.className="row";
    const r2=document.createElement("div");r2.className="row";
    const back=document.createElement("div");back.className="back";

    [r1,r2,back].forEach(x=>Sortable.create(x,{group:`g${i}`}));

    g.slice(0,2).forEach(n=>r1.appendChild(seat(n)));
    g.slice(2,4).forEach(n=>r2.appendChild(seat(n)));
    back.appendChild(seat(g[4]));

    d.append(r1,r2,document.createElement("hr"),back);
    box.appendChild(d);
  });

  canvasArea.appendChild(box);
}

function seat(name){
  const d=document.createElement("div");
  d.className="seat";
  d.textContent=name;
  return d;
}

function toggleFullscreen(){
  document.body.classList.toggle("fullscreen");
}

function exportPDF(){
  html2canvas(canvasArea,{scale:2}).then(c=>{
    const pdf=new jspdf.jsPDF("p","mm","a4");
    const img=c.toDataURL("image/png");
    const w=190;
    const h=c.height*w/c.width;
    pdf.addImage(img,"PNG",10,10,w,h);
    pdf.save("åº§ä½è¡¨.pdf");
  });
}
</script>

</body>
</html>
