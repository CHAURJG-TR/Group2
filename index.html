<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>æ•™å®¤åˆ†çµ„ç³»çµ±ï¼ˆç”·å¥³åˆ†é–‹å®Œæ•´ç‰ˆï¼‰</title>

<!-- PDF å¥—ä»¶ -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
body {
  font-family: "Noto Sans TC", "Microsoft JhengHei", sans-serif;
  background: #f4f6f8;
  padding: 20px;
  margin: 0;
}
h1 { font-size: 28px; }
textarea {
  width: 100%;
  height: 120px;
  font-size: 18px;
}
button {
  font-size: 18px;
  padding: 8px 14px;
  margin: 4px;
  cursor: pointer;
}
#stage {
  margin-top: 20px;
  background: #f4f6f8;
  padding: 10px;
}
.stage-board {
  background: #333;
  color: #fff;
  text-align: center;
  padding: 14px;
  font-size: 28px;
  margin-bottom: 20px;
}
.groups {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20px;
}
.group {
  background: #fff;
  border-radius: 12px;
  padding: 10px;
}
.group h3 {
  text-align: center;
  margin: 0 0 10px;
}
.seat {
  background: #e3e7ee;
  padding: 8px;
  margin: 6px 0;
  border-radius: 6px;
  font-size: 22px;
  cursor: pointer;
}
/* ç›´æ’æ¨¡å¼ */
.column-mode .groups { grid-template-columns: 1fr; }
.column {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 10px;
}
/* æŠ•å½± */
.fullscreen { font-size: 34px; }
</style>
</head>
<body>

<h1>ğŸ¯ æ•™å®¤åˆ†çµ„ç³»çµ±</h1>

<h3>ğŸ“‹ å­¸ç”Ÿåå–®ï¼ˆå‰10ç”·ã€å¾Œ10å¥³ï¼‰</h3>
<textarea id="students">
ç”·ç”Ÿ1
ç”·ç”Ÿ2
ç”·ç”Ÿ3
ç”·ç”Ÿ4
ç”·ç”Ÿ5
ç”·ç”Ÿ6
ç”·ç”Ÿ7
ç”·ç”Ÿ8
ç”·ç”Ÿ9
ç”·ç”Ÿ10
å¥³ç”Ÿ1
å¥³ç”Ÿ2
å¥³ç”Ÿ3
å¥³ç”Ÿ4
å¥³ç”Ÿ5
å¥³ç”Ÿ6
å¥³ç”Ÿ7
å¥³ç”Ÿ8
å¥³ç”Ÿ9
å¥³ç”Ÿ10
</textarea>

<h3>ğŸš« ä¸èƒ½åŒçµ„ï¼ˆå¯é¸å¡«ï¼‰</h3>
<textarea id="banRules"></textarea>

<div>
  <button id="generateBtn" onclick="generate()">ç”Ÿæˆå°çµ„</button>
  <button id="modeBtn" onclick="toggleMode()">ğŸ“Š ç›´æ’æ¨¡å¼</button>
  <button onclick="toggleFullscreen()">ğŸ–¥ï¸ æŠ•å½±æ¨¡å¼</button>
  <button onclick="exportPDF()">ğŸ–¨ï¸ åŒ¯å‡º PDF</button>
  <button onclick="resetAll()">ğŸ”„ é‡è¨­</button>
</div>

<div id="stage"></div>

<script>
let columnMode = false;
const GROUP_COUNT = 4;

// å–å¾—å­¸ç”Ÿ
function getStudents(){
  return students.value.split("\n").map(s=>s.trim()).filter(Boolean);
}

// éš¨æ©Ÿæ’åˆ—
function shuffle(arr){ return [...arr].sort(()=>Math.random()-0.5); }

// ğŸ”’ å»ºç«‹åº§ä½ï¼ˆåŠ å…¥é˜²å‘†ï¼Œå¤–è§€ä¸è®Šï¼‰
function createSeat(name){
  const d = document.createElement("div");
  d.className = "seat";
  d.textContent = name;

  d.onclick = ()=>{
    const newName = prompt("è«‹è¼¸å…¥æ–°çš„å­¸ç”Ÿå§“åï¼š", d.textContent);
    if(newName===null) return; // å–æ¶ˆ
    const trimmed = newName.trim();
    if(!trimmed){
      alert("âŒ å§“åä¸èƒ½æ˜¯ç©ºç™½");
      return;
    }
    const seats = document.querySelectorAll(".seat");
    for(const s of seats){
      if(s!==d && s.textContent===trimmed){
        alert("âŒ å·²æœ‰ç›¸åŒå§“å");
        return;
      }
    }
    d.textContent = trimmed; // âœ… é€šéæ‰æ”¹
  };

  return d;
}

// ç”Ÿæˆå°çµ„ï¼ˆç”·å¥³åˆ†é–‹ï¼‰
function generate(){
  const allStudents = getStudents();
  const maleStudents = allStudents.slice(0,10);
  const femaleStudents = allStudents.slice(10);
  renderSeparatedGroups(maleStudents,femaleStudents);
}

// æ¸²æŸ“ç”·å¥³åˆ†é–‹å°çµ„
function renderSeparatedGroups(males,females){
  stage.innerHTML="";
  stage.className = columnMode ? "column-mode" : "";

  // è¬›å°
  const board = document.createElement("div");
  board.className="stage-board";
  board.textContent="ğŸ“¢ è¬›å°";
  stage.appendChild(board);

  const groups = document.createElement("div");
  groups.className="groups";

  if(columnMode){
    const col = document.createElement("div");
    col.className="column";
    shuffle(males.concat(females)).forEach(s=>{
      col.appendChild(createSeat(s));
    });
    groups.appendChild(col);
  }else{
    // å‰2çµ„ç”·ç”Ÿ
    const maleShuffled = shuffle(males);
    for(let i=0;i<2;i++){
      const g = document.createElement("div");
      g.className="group";
      g.innerHTML="<h3>ç¬¬ "+(i+1)+" çµ„ (ç”·ç”Ÿ)</h3>";
      maleShuffled.slice(i*5,(i+1)*5).forEach(s=>{
        g.appendChild(createSeat(s));
      });
      groups.appendChild(g);
    }
    // å¾Œ2çµ„å¥³ç”Ÿ
    const femaleShuffled = shuffle(females);
    for(let i=0;i<2;i++){
      const g = document.createElement("div");
      g.className="group";
      g.innerHTML="<h3>ç¬¬ "+(i+3)+" çµ„ (å¥³ç”Ÿ)</h3>";
      femaleShuffled.slice(i*5,(i+1)*5).forEach(s=>{
        g.appendChild(createSeat(s));
      });
      groups.appendChild(g);
    }
  }

  stage.appendChild(groups);
}

// æ¨¡å¼åˆ‡æ›
function toggleMode(){
  columnMode=!columnMode;
  modeBtn.textContent = columnMode ? "ğŸ“Š å°çµ„æ¨¡å¼" : "ğŸ“Š ç›´æ’æ¨¡å¼";
  generateBtn.textContent = columnMode ? "ç”Ÿæˆç›´æ’" : "ç”Ÿæˆå°çµ„";
}

// æŠ•å½±æ¨¡å¼
function toggleFullscreen(){
  if(!document.fullscreenElement){
    document.documentElement.requestFullscreen();
    document.body.classList.add("fullscreen");
  }else{
    document.exitFullscreen();
    document.body.classList.remove("fullscreen");
  }
}

// åŒ¯å‡º PDF
function exportPDF(){
  html2canvas(stage,{scale:2}).then(canvas=>{
    const img = canvas.toDataURL("image/png");
    const pdf = new jspdf.jsPDF("p","mm","a4");
    const w = 210;
    const h = canvas.height * w / canvas.width;
    pdf.addImage(img,"PNG",0,10,w,h);
    pdf.save("åº§ä½è¡¨.pdf");
  });
}

// é‡è¨­
function resetAll(){ stage.innerHTML=""; }

</script>
</body>
</html>
