<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>æ•™å®¤åˆ†çµ„ç³»çµ±ï¼ˆç”·å¥³åˆ†çµ„ 4+1 æ’åˆ—ï¼‰</title>

<!-- PDF -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<!-- æ‹–æ‹‰ -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

<style>
body {
  font-family: "Noto Sans TC","Microsoft JhengHei",sans-serif;
  background:#f4f6f8;
  padding:20px;margin:0;
}
h1{font-size:28px;}
button{font-size:18px;padding:8px 14px;margin:4px;cursor:pointer;}

#stage{margin-top:20px;background:#f4f6f8;padding:10px;}
.stage-board{
  background:#333;color:#fff;text-align:center;
  padding:14px;font-size:28px;margin-bottom:20px;
}
.groups{display:grid;grid-template-columns:repeat(2,1fr);gap:20px;}
.group{
  background:#fff;border-radius:12px;padding:10px;
}
.group h3{text-align:center;margin:0 0 10px;}
.seat{
  background:#e3e7ee;padding:8px;margin:6px 0;
  border-radius:6px;font-size:22px;
  cursor:pointer;text-align:center;
}
/* é¢å°é¢æ’åˆ— */
.face-row{display:flex;justify-content:space-between;}
.back-seat{text-align:center;margin-top:10px;}
/* ç›´æ’æ¨¡å¼ */
.column-mode .groups{grid-template-columns:1fr;}
.column{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;}
.fullscreen{font-size:34px;}
</style>
</head>
<body>

<h1>æ•™å®¤åˆ†çµ„ç³»çµ±ï¼ˆç”·å¥³åˆ†çµ„ 4+1 é¢å°é¢ï¼‰</h1>

<div>
  <button id="generateBtn" onclick="generate()">ç”Ÿæˆå°çµ„</button>
  <button id="modeBtn" onclick="toggleMode()">ğŸ“Š ç›´æ’æ¨¡å¼</button>
  <button onclick="toggleFullscreen()">ğŸ–¥ï¸ æŠ•å½±æ¨¡å¼</button>
  <button onclick="exportPDF()">ğŸ–¨ï¸ åŒ¯å‡º PDF</button>
  <button onclick="resetAll()">ğŸ”„ é‡è¨­</button>
</div>

<div id="stage"></div>

<script>
let columnMode=false;
const GROUP_COUNT=4;

// é è¨­å­¸ç”Ÿåå–®
const defaultMale=["ç”·ç”Ÿ1","ç”·ç”Ÿ2","ç”·ç”Ÿ3","ç”·ç”Ÿ4","ç”·ç”Ÿ5","ç”·ç”Ÿ6","ç”·ç”Ÿ7","ç”·ç”Ÿ8","ç”·ç”Ÿ9","ç”·ç”Ÿ10"];
const defaultFemale=["å¥³ç”Ÿ1","å¥³ç”Ÿ2","å¥³ç”Ÿ3","å¥³ç”Ÿ4","å¥³ç”Ÿ5","å¥³ç”Ÿ6","å¥³ç”Ÿ7","å¥³ç”Ÿ8","å¥³ç”Ÿ9","å¥³ç”Ÿ10"];

// éš¨æ©Ÿæ’åˆ—
function shuffle(arr){return [...arr].sort(()=>Math.random()-0.5);}

// é˜²å‘†åº§ä½å»ºç«‹
function createSeat(name){
  const d=document.createElement("div");
  d.className="seat";
  d.textContent=name;
  d.onclick=()=>{
    const newName=prompt("è«‹è¼¸å…¥æ–°çš„å­¸ç”Ÿå§“åï¼š",d.textContent);
    if(newName===null) return;
    const trimmed=newName.trim();
    if(!trimmed){alert("âŒ å§“åä¸èƒ½æ˜¯ç©ºç™½");return;}
    const seats=document.querySelectorAll(".seat");
    for(const s of seats){if(s!==d && s.textContent===trimmed){alert("âŒ å·²æœ‰ç›¸åŒå§“å");return;}}
    d.textContent=trimmed;
  };
  return d;
}

// ç”Ÿæˆç”·å¥³åˆ†é–‹å°çµ„
function generate(){
  renderSeparatedGroups(shuffle(defaultMale),shuffle(defaultFemale));
}

// æ¸²æŸ“ç”·å¥³åˆ†é–‹å°çµ„ + 4+1 é¢å°é¢
function renderSeparatedGroups(males,females){
  stage.innerHTML="";
  stage.className = columnMode ? "column-mode" : "";

  // è¬›å°
  const board=document.createElement("div");
  board.className="stage-board";
  board.textContent="ğŸ“¢ è¬›å°";
  stage.appendChild(board);

  const groups=document.createElement("div");
  groups.className="groups";

  const allGroups=[...males,...females];
  // å‰2çµ„ç”·ç”Ÿ
  for(let g=0;g<2;g++){
    const groupDiv=document.createElement("div");
    groupDiv.className="group";
    groupDiv.innerHTML=`<h3>ç¬¬ ${g+1} çµ„ (ç”·ç”Ÿ)</h3>`;
    // 4äººé¢å°é¢
    const faceRow1=document.createElement("div"); faceRow1.className="face-row";
    const faceRow2=document.createElement("div"); faceRow2.className="face-row";
    for(let i=0;i<2;i++) faceRow1.appendChild(createSeat(males[g*5+i]));
    for(let i=0;i<2;i++) faceRow2.appendChild(createSeat(males[g*5+i+2]));
    const backSeat=document.createElement("div"); backSeat.className="back-seat";
    backSeat.appendChild(createSeat(males[g*5+4])); // å¾Œåº§
    groupDiv.appendChild(faceRow1); groupDiv.appendChild(faceRow2); groupDiv.appendChild(backSeat);
    groups.appendChild(groupDiv);
  }

  // å¾Œ2çµ„å¥³ç”Ÿ
  for(let g=0;g<2;g++){
    const groupDiv=document.createElement("div");
    groupDiv.className="group";
    groupDiv.innerHTML=`<h3>ç¬¬ ${g+3} çµ„ (å¥³ç”Ÿ)</h3>`;
    const faceRow1=document.createElement("div"); faceRow1.className="face-row";
    const faceRow2=document.createElement("div"); faceRow2.className="face-row";
    for(let i=0;i<2;i++) faceRow1.appendChild(createSeat(females[g*5+i]));
    for(let i=0;i<2;i++) faceRow2.appendChild(createSeat(females[g*5+i+2]));
    const backSeat=document.createElement("div"); backSeat.className="back-seat";
    backSeat.appendChild(createSeat(females[g*5+4]));
    groupDiv.appendChild(faceRow1); groupDiv.appendChild(faceRow2); groupDiv.appendChild(backSeat);
    groups.appendChild(groupDiv);
  }

  stage.appendChild(groups);

  // çµ„å…§æ‹–æ‹‰
  document.querySelectorAll(".group").forEach(g=>{
    new Sortable(g,{animation:150,filter:"h3"});
  });
}

// æ¨¡å¼åˆ‡æ›
function toggleMode(){
  columnMode=!columnMode;
  modeBtn.textContent=columnMode?"ğŸ“Š å°çµ„æ¨¡å¼":"ğŸ“Š ç›´æ’æ¨¡å¼";
  generateBtn.textContent=columnMode?"ç”Ÿæˆç›´æ’":"ç”Ÿæˆå°çµ„";
}

// æŠ•å½±æ¨¡å¼
function toggleFullscreen(){
  if(!document.fullscreenElement){document.documentElement.requestFullscreen();document.body.classList.add("fullscreen");}
  else{document.exitFullscreen();document.body.classList.remove("fullscreen");}
}

// åŒ¯å‡º PDF
function exportPDF(){
  html2canvas(stage,{scale:2}).then(canvas=>{
    const img=canvas.toDataURL("image/png");
    const pdf=new jspdf.jsPDF("p","mm","a4");
    const w=210;
    const h=canvas.height*w/canvas.width;
    pdf.addImage(img,"PNG",0,10,w,h);
    pdf.save("åº§ä½è¡¨.pdf");
  });
}

// é‡è¨­
function resetAll(){ stage.innerHTML=""; }

</script>
</body>
</html>
